<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="0">

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_param_a_e" model="tvbo.parameter">
            <field name="name">a_e</field>
            <field name="label">Excitatory input gain</field>
            <field name="value">310.0</field>
            <field name="unit">n/C</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_param_b_e" model="tvbo.parameter">
            <field name="name">b_e</field>
            <field name="label">Excitatory input shift</field>
            <field name="value">125.0</field>
            <field name="unit">Hz</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_param_d_e" model="tvbo.parameter">
            <field name="name">d_e</field>
            <field name="label">Excitatory input scaling</field>
            <field name="value">0.16</field>
            <field name="unit">s</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_param_gamma_e" model="tvbo.parameter">
            <field name="name">gamma_e</field>
            <field name="label">Excitatory kinetic parameter</field>
            <field name="value">0.000641</field>
            <field name="description">gamma_e = 0.641/1000</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_param_tau_e" model="tvbo.parameter">
            <field name="name">tau_e</field>
            <field name="label">Excitatory NMDA decay time constant</field>
            <field name="value">100.0</field>
            <field name="unit">ms</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_param_w_p" model="tvbo.parameter">
            <field name="name">w_p</field>
            <field name="label">Excitatory recurrence weight</field>
            <field name="value">1.4</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_param_w_e" model="tvbo.parameter">
            <field name="name">W_e</field>
            <field name="label">External input scaling (excitatory)</field>
            <field name="value">1.0</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_param_a_i" model="tvbo.parameter">
            <field name="name">a_i</field>
            <field name="label">Inhibitory input gain</field>
            <field name="value">615.0</field>
            <field name="unit">n/C</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_param_b_i" model="tvbo.parameter">
            <field name="name">b_i</field>
            <field name="label">Inhibitory input shift</field>
            <field name="value">177.0</field>
            <field name="unit">Hz</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_param_d_i" model="tvbo.parameter">
            <field name="name">d_i</field>
            <field name="label">Inhibitory input scaling</field>
            <field name="value">0.087</field>
            <field name="unit">s</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_param_gamma_i" model="tvbo.parameter">
            <field name="name">gamma_i</field>
            <field name="label">Inhibitory kinetic parameter</field>
            <field name="value">0.001</field>
            <field name="description">gamma_i = 1.0/1000</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_param_tau_i" model="tvbo.parameter">
            <field name="name">tau_i</field>
            <field name="label">Inhibitory NMDA decay time constant</field>
            <field name="value">10.0</field>
            <field name="unit">ms</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_param_w_i" model="tvbo.parameter">
            <field name="name">W_i</field>
            <field name="label">External input scaling (inhibitory)</field>
            <field name="value">0.7</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_param_j_n" model="tvbo.parameter">
            <field name="name">J_N</field>
            <field name="label">NMDA current</field>
            <field name="value">0.15</field>
            <field name="unit">nA</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_param_j_i" model="tvbo.parameter">
            <field name="name">J_i</field>
            <field name="label">Inhibitory synaptic weight</field>
            <field name="value">1.0</field>
            <field name="description">Tuned by FIC algorithm, can be heterogeneous</field>
            <field name="free">True</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_param_i_o" model="tvbo.parameter">
            <field name="name">I_o</field>
            <field name="label">Background input current</field>
            <field name="value">0.382</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_param_i_ext" model="tvbo.parameter">
            <field name="name">I_ext</field>
            <field name="label">External stimulation current</field>
            <field name="value">0.0</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_param_lamda" model="tvbo.parameter">
            <field name="name">lamda</field>
            <field name="label">Inhibitory coupling scaling (lambda)</field>
            <field name="value">1.0</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_sv_s_e_eq" model="tvbo.equation">
            <field name="label">dS_e/dt</field>
            <field name="lefthandside">dS_e/dt</field>
            <field name="righthandside">-(S_e / tau_e) + (1.0 - S_e) * H_e * gamma_e</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_sv_s_e" model="tvbo.state_variable">
            <field name="name">S_e</field>
            <field name="label">Excitatory synaptic gating</field>
            <field name="initial_value">0.001</field>
            <field name="coupling_variable">True</field>
            <field name="description">Fraction of open NMDA channels (excitatory)</field>
            <field name="equation" ref="exp_ei_tuning_fic_eib_optimization_dyn_sv_s_e_eq"/>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_sv_s_i_eq" model="tvbo.equation">
            <field name="label">dS_i/dt</field>
            <field name="lefthandside">dS_i/dt</field>
            <field name="righthandside">-(S_i / tau_i) + H_i * gamma_i</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_sv_s_i" model="tvbo.state_variable">
            <field name="name">S_i</field>
            <field name="label">Inhibitory synaptic gating</field>
            <field name="initial_value">0.001</field>
            <field name="description">Fraction of open NMDA channels (inhibitory)</field>
            <field name="equation" ref="exp_ei_tuning_fic_eib_optimization_dyn_sv_s_i_eq"/>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_dv_x_e_pre_eq" model="tvbo.equation">
            <field name="label">x_e_pre</field>
            <field name="lefthandside">x_e_pre</field>
            <field name="righthandside">w_p * J_N * S_e - J_i * S_i + W_e * I_o + J_N * c_lre + I_ext</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_dv_x_e_pre" model="tvbo.derived_variable">
            <field name="name">x_e_pre</field>
            <field name="label">Excitatory pre-activation</field>
            <field name="equation" ref="exp_ei_tuning_fic_eib_optimization_dyn_dv_x_e_pre_eq"/>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_dv_x_e_eq" model="tvbo.equation">
            <field name="label">x_e</field>
            <field name="lefthandside">x_e</field>
            <field name="righthandside">a_e * x_e_pre - b_e</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_dv_x_e" model="tvbo.derived_variable">
            <field name="name">x_e</field>
            <field name="label">Excitatory activation</field>
            <field name="equation" ref="exp_ei_tuning_fic_eib_optimization_dyn_dv_x_e_eq"/>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_dv_h_e_eq" model="tvbo.equation">
            <field name="label">H_e</field>
            <field name="lefthandside">H_e</field>
            <field name="righthandside">x_e / (1.0 - exp(-d_e * x_e))</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_dv_h_e" model="tvbo.derived_variable">
            <field name="name">H_e</field>
            <field name="label">Excitatory firing rate</field>
            <field name="description">Sigmoidal transfer function for excitatory population</field>
            <field name="equation" ref="exp_ei_tuning_fic_eib_optimization_dyn_dv_h_e_eq"/>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_dv_x_i_pre_eq" model="tvbo.equation">
            <field name="label">x_i_pre</field>
            <field name="lefthandside">x_i_pre</field>
            <field name="righthandside">J_N * S_e - S_i + W_i * I_o + lamda * J_N * c_ffi</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_dv_x_i_pre" model="tvbo.derived_variable">
            <field name="name">x_i_pre</field>
            <field name="label">Inhibitory pre-activation</field>
            <field name="equation" ref="exp_ei_tuning_fic_eib_optimization_dyn_dv_x_i_pre_eq"/>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_dv_x_i_eq" model="tvbo.equation">
            <field name="label">x_i</field>
            <field name="lefthandside">x_i</field>
            <field name="righthandside">a_i * x_i_pre - b_i</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_dv_x_i" model="tvbo.derived_variable">
            <field name="name">x_i</field>
            <field name="label">Inhibitory activation</field>
            <field name="equation" ref="exp_ei_tuning_fic_eib_optimization_dyn_dv_x_i_eq"/>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_dv_h_i_eq" model="tvbo.equation">
            <field name="label">H_i</field>
            <field name="lefthandside">H_i</field>
            <field name="righthandside">x_i / (1.0 - exp(-d_i * x_i))</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dyn_dv_h_i" model="tvbo.derived_variable">
            <field name="name">H_i</field>
            <field name="label">Inhibitory firing rate</field>
            <field name="description">Sigmoidal transfer function for inhibitory population</field>
            <field name="equation" ref="exp_ei_tuning_fic_eib_optimization_dyn_dv_h_i_eq"/>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dynamics" model="tvbo.dynamics">
            <field name="name">ReducedWongWangEIB</field>
            <field name="label">Two-Population Reduced Wong-Wang Model</field>
            <field name="description">Biophysically-based neural mass model with explicit excitatory (E) and inhibitory (I) populations. Each population has separate synaptic gating variables (S_e, S_i) and transfer functions. Enables independent control of E-I balance via the J_i parameter.
</field>
            <field name="parameters" eval="[(6, 0, [ref('exp_ei_tuning_fic_eib_optimization_dyn_param_a_e'), ref('exp_ei_tuning_fic_eib_optimization_dyn_param_b_e'), ref('exp_ei_tuning_fic_eib_optimization_dyn_param_d_e'), ref('exp_ei_tuning_fic_eib_optimization_dyn_param_gamma_e'), ref('exp_ei_tuning_fic_eib_optimization_dyn_param_tau_e'), ref('exp_ei_tuning_fic_eib_optimization_dyn_param_w_p'), ref('exp_ei_tuning_fic_eib_optimization_dyn_param_w_e'), ref('exp_ei_tuning_fic_eib_optimization_dyn_param_a_i'), ref('exp_ei_tuning_fic_eib_optimization_dyn_param_b_i'), ref('exp_ei_tuning_fic_eib_optimization_dyn_param_d_i'), ref('exp_ei_tuning_fic_eib_optimization_dyn_param_gamma_i'), ref('exp_ei_tuning_fic_eib_optimization_dyn_param_tau_i'), ref('exp_ei_tuning_fic_eib_optimization_dyn_param_w_i'), ref('exp_ei_tuning_fic_eib_optimization_dyn_param_j_n'), ref('exp_ei_tuning_fic_eib_optimization_dyn_param_j_i'), ref('exp_ei_tuning_fic_eib_optimization_dyn_param_i_o'), ref('exp_ei_tuning_fic_eib_optimization_dyn_param_i_ext'), ref('exp_ei_tuning_fic_eib_optimization_dyn_param_lamda')])]"/>
            <field name="state_variables" eval="[(6, 0, [ref('exp_ei_tuning_fic_eib_optimization_dyn_sv_s_e'), ref('exp_ei_tuning_fic_eib_optimization_dyn_sv_s_i')])]"/>
            <field name="derived_variables" eval="[(6, 0, [ref('exp_ei_tuning_fic_eib_optimization_dyn_dv_x_e_pre'), ref('exp_ei_tuning_fic_eib_optimization_dyn_dv_x_e'), ref('exp_ei_tuning_fic_eib_optimization_dyn_dv_h_e'), ref('exp_ei_tuning_fic_eib_optimization_dyn_dv_x_i_pre'), ref('exp_ei_tuning_fic_eib_optimization_dyn_dv_x_i'), ref('exp_ei_tuning_fic_eib_optimization_dyn_dv_h_i')])]"/>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_cp_eiblinearcoupling_wlre_range" model="tvbo.range">
            <field name="lo">0.0</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_cp_eiblinearcoupling_wlre" model="tvbo.parameter">
            <field name="name">wLRE</field>
            <field name="label">Long-range excitation weights</field>
            <field name="value">1.0</field>
            <field name="description">Weight matrix for excitatory long-range coupling</field>
            <field name="free">True</field>
            <field name="domain" ref="exp_ei_tuning_fic_eib_optimization_cp_eiblinearcoupling_wlre_range"/>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_cp_eiblinearcoupling_wffi_range" model="tvbo.range">
            <field name="lo">0.0</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_cp_eiblinearcoupling_wffi" model="tvbo.parameter">
            <field name="name">wFFI</field>
            <field name="label">Feedforward inhibition weights</field>
            <field name="value">1.0</field>
            <field name="description">Weight matrix for feedforward inhibition</field>
            <field name="free">True</field>
            <field name="domain" ref="exp_ei_tuning_fic_eib_optimization_cp_eiblinearcoupling_wffi_range"/>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_coupling_eiblinearcoupling_pre_expr" model="tvbo.equation">
            <field name="righthandside">[S_e * wLRE, S_e * wFFI]</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_coupling_eiblinearcoupling_post_expr" model="tvbo.equation">
            <field name="righthandside">gx</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_coupling_eiblinearcoupling" model="tvbo.coupling">
            <field name="name">EIBLinearCoupling</field>
            <field name="label">EIB Linear Coupling</field>
            <field name="description">Dual-weight coupling producing two outputs from excitatory activity: long-range excitation (wLRE) and feedforward inhibition (wFFI). Separate weight matrices enable independent tuning of E and I pathways. N_OUTPUT_STATES = 2.
</field>
            <field name="delayed">False"</field>
            <field name="pre_expression" ref="exp_ei_tuning_fic_eib_optimization_coupling_eiblinearcoupling_pre_expr"/>
            <field name="post_expression" ref="exp_ei_tuning_fic_eib_optimization_coupling_eiblinearcoupling_post_expr"/>
            <field name="parameters" eval="[(6, 0, [ref('exp_ei_tuning_fic_eib_optimization_cp_eiblinearcoupling_wlre'), ref('exp_ei_tuning_fic_eib_optimization_cp_eiblinearcoupling_wffi')])]"/>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_network" model="tvbo.network">
            <field name="label">Desikan-Killiany</field>
            <field name="description">Structural connectivity from dk_average dataset</field>
            <field name="bids_dir">../networks/bids/dk_average</field>
            <field name="coupling" eval="[(6, 0, [ref('exp_ei_tuning_fic_eib_optimization_coupling_eiblinearcoupling')])]"/>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_integrator" model="tvbo.integrator">
            <field name="method">Heun</field>
            <field name="step_size">4.0</field>
            <field name="duration">300000</field>
            <field name="transient_time">300000</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_execution" model="tvbo.execution_config">
            <field name="n_workers">8</field>
            <field name="precision">float64</field>
            <field name="random_seed">0</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_func_hrf_kernel" model="tvbo.function">
            <field name="name">hrf_kernel</field>
            <field name="description">Hemodynamic response function kernel (Lotka-Volterra).
Analytical solution for balloon model impulse response.
</field>
            <field name="definition">(1/3)*exp(-0.5*(t/1000)/tau_s)*sin(sqrt(1/tau_f - 1/(4*tau_s**2))*(t/1000))/sqrt(1/tau_f - 1/(4*tau_s**2))</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_func_prepend_history" model="tvbo.function">
            <field name="name">prepend_history</field>
            <field name="description">Prepend transient history to data for convolution warmup.
Concatenates last K samples of history before data along axis 0.
</field>
            <field name="definition">concatenate(history, data, 0)</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_func_volterra_transform" model="tvbo.function">
            <field name="name">volterra_transform</field>
            <field name="description">Volterra nonlinear BOLD transformation.
Linear approximation of BOLD signal from neural activity.
</field>
            <field name="definition">k_1 * V_0 * (data[t,i] - 1)</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_func_subsample_bold" model="tvbo.function">
            <field name="name">subsample_bold</field>
            <field name="description">Subsample time series to match BOLD TR.
Selects every s-th sample from input.
</field>
            <field name="source_code">data[::s]</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_func_rmse" model="tvbo.function">
            <field name="name">rmse</field>
            <field name="description">Row-wise root mean squared error using pure mathematical notation.
Uses SymPy indexed notation: Sum((a[i,j] - b[i,j])**2, (j, 0, m-1))
The code generator automatically infers axis=1 from the j index position.
When used with 2D expressions, broadcasting is automatically added.
</field>
            <field name="definition">sqrt(Sum((a[i,j] - b[i,j])**2, (j, 0, m-1)) / m)</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_func_correlation" model="tvbo.function">
            <field name="name">correlation</field>
            <field name="description">Pearson correlation coefficient between two vectors.
Mathematical definition using indexed notation.
</field>
            <field name="definition">Sum((x[t] - mean(x))*(y[t] - mean(y)), (t, 0, T-1)) / (sqrt(Sum((x[t] - mean(x))**2, (t, 0, T-1))) * sqrt(Sum((y[t] - mean(y))**2, (t, 0, T-1))))</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_func_fc_corr" model="tvbo.function">
            <field name="name">fc_corr</field>
            <field name="description">Correlation between two FC matrices (flattened).
Measures similarity between predicted and target functional connectivity.
</field>
            <field name="definition">Sum((A[i,j] - mean(A))*(B[i,j] - mean(B)), (i, 0, N_nodes-1), (j, 0, N_nodes-1)) / (sqrt(Sum((A[i,j] - mean(A))**2, (i, 0, N_nodes-1), (j, 0, N_nodes-1))) * sqrt(Sum((B[i,j] - mean(B))**2, (i, 0, N_nodes-1), (j, 0, N_nodes-1))))</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_func_fc_rmse" model="tvbo.function">
            <field name="name">fc_rmse</field>
            <field name="description">Root mean squared error between two FC matrices.
Measures discrepancy between predicted and target functional connectivity.
</field>
            <field name="definition">sqrt(Sum((A[i,j] - B[i,j])**2, (i, 0, N_nodes-1), (j, 0, N_nodes-1)) / (N_nodes*N_nodes))</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_func_compute_fc" model="tvbo.function">
            <field name="name">compute_fc</field>
            <field name="description">Functional connectivity matrix as Pearson correlations between node time series.
FC[i,j] = correlation(timeseries[:, i], timeseries[:, j])
Diagonal is set to 0 (no self-connections in FC).
</field>
            <field name="definition">Sum((X[t,i] - mean_i)*(X[t,j] - mean_j), (t, 0, T-1)) / (sqrt(Sum((X[t,i] - mean_i)**2, (t, 0, T-1))) * sqrt(Sum((X[t,j] - mean_j)**2, (t, 0, T-1))))</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_func_mean_activity" model="tvbo.function">
            <field name="name">mean_activity</field>
            <field name="description">Temporal mean of activity at each node.
Computes mean over time dimension for a specific state variable.
</field>
            <field name="definition">Sum(X[t,i], (t, 0, T-1)) / T</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_func_fic_update_rule" model="tvbo.function">
            <field name="name">FIC_update_rule</field>
            <field name="description">Feedback Inhibition Control (FIC) update rule.
Adjusts inhibitory weight J_i to drive mean excitatory activity toward target.
Based on: ΔJ_i ∝ S_i * (S_e - target)
</field>
            <field name="definition">J_i[k] + eta * mean_S_i[k] * (mean_S_e[k] - target)</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_func_eib_update_wlre" model="tvbo.function">
            <field name="name">EIB_update_wLRE</field>
            <field name="description">EIB update for long-range excitation (wLRE).
Increases coupling where FC is below target, scaled by node-wise RMSE.
</field>
            <field name="definition">wLRE[i,k] + eta * (fc_target[i,k] - fc[i,k]) * sqrt(Sum((fc_target[i,j] - fc[i,j])**2, (j, 0, N_nodes-1)) / N_nodes)</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_func_eib_update_wffi" model="tvbo.function">
            <field name="name">EIB_update_wFFI</field>
            <field name="description">EIB update for feedforward inhibition (wFFI).
Decreases inhibition where FC is below target, scaled by node-wise RMSE.
</field>
            <field name="definition">wFFI[i,k] - eta * (fc_target[i,k] - fc[i,k]) * sqrt(Sum((fc_target[i,j] - fc[i,j])**2, (j, 0, N_nodes-1)) / N_nodes)</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_func_combined_loss" model="tvbo.function">
            <field name="name">combined_loss</field>
            <field name="description">Combined loss for gradient-based EI tuning.
L = RMSE(FC_pred, FC_target) + MSE(activity, target_activity)
Note: No alpha scaling - both terms contribute equally as in original.
</field>
            <field name="definition">sqrt(Sum((fc_pred[i,j] - fc_target[i,j])**2, (i, 0, N_nodes-1), (j, 0, N_nodes-1)) / (N_nodes*N_nodes)) + Sum((mean_activity[k] - target_activity)**2, (k, 0, N_nodes-1)) / N_nodes</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_obs_bold" model="tvbo.observation">
            <field name="name">bold</field>
            <field name="label">Simulated BOLD Signal</field>
            <field name="description">BOLD signal from hemodynamic response function</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_obs_mean_s_e" model="tvbo.observation">
            <field name="name">mean_S_e</field>
            <field name="label">Mean Excitatory Activity</field>
            <field name="description">Mean S_e over simulation window (for FIC algorithms)</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_obs_mean_s_e_final" model="tvbo.observation">
            <field name="name">mean_S_e_final</field>
            <field name="label">Mean Excitatory Activity (Final 500 Timesteps)</field>
            <field name="description">Mean S_e over final 500 timesteps (for gradient optimization loss)</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_obs_mean_s_i" model="tvbo.observation">
            <field name="name">mean_S_i</field>
            <field name="label">Mean Inhibitory Activity</field>
            <field name="description">Mean S_i over simulation window (for FIC)</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_obs_fc_target" model="tvbo.observation">
            <field name="name">fc_target</field>
            <field name="label">Empirical Functional Connectivity</field>
            <field name="description">Target FC matrix from network observations (loaded from BIDS)</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dobs_fc" model="tvbo.derived_observation">
            <field name="name">fc</field>
            <field name="label">Simulated Functional Connectivity (Post-Tuning)</field>
            <field name="description">Pearson correlation matrix from BOLD time series (skip_t=20 for post-tuning evaluation)</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dobs_fc_inloop" model="tvbo.derived_observation">
            <field name="name">fc_inloop</field>
            <field name="label">Simulated Functional Connectivity (In-Loop)</field>
            <field name="description">FC computed on sliding window without transient skip (for algorithm in-loop)</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dobs_fc_gradient" model="tvbo.derived_observation">
            <field name="name">fc_gradient</field>
            <field name="label">Simulated FC for Gradient Optimization</field>
            <field name="description">FC computation for gradient optimization (skip_t=30 as in original)</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dobs_fc_corr" model="tvbo.derived_observation">
            <field name="name">fc_corr</field>
            <field name="label">FC Correlation with Target</field>
            <field name="description">Pearson correlation between simulated FC and empirical FC target</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_dobs_fc_rmse" model="tvbo.derived_observation">
            <field name="name">fc_rmse</field>
            <field name="label">FC RMSE with Target</field>
            <field name="description">Root mean squared error between simulated FC and empirical FC target</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_algo_fic" model="tvbo.algorithm">
            <field name="name">fic</field>
            <field name="description">Feedback Inhibition Control adjusts local inhibitory weight (J_i) to maintain excitatory activity at target level. When S_e &gt; target, J_i increases; when S_e &lt; target, J_i decreases.
</field>
            <field name="n_iterations">200</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_algo_fic_eib" model="tvbo.algorithm">
            <field name="name">fic_eib</field>
            <field name="description">Combined FIC+EIB tuning loop. Applies both Feedback Inhibition Control (J_i adjustment) and Excitation-Inhibition Balance tuning (wLRE, wFFI) in each iteration. Matches Schirner et al. 2023 implementation.
</field>
            <field name="n_iterations">2000</field>
        </record>

        <record id="exp_ei_tuning_fic_eib_optimization_opt_gradient_eib" model="tvbo.optimization">
            <field name="name">gradient_eib</field>
            <field name="label">Gradient-Based EI Tuning</field>
            <field name="description">Alternative to iterative FIC+EIB: define combined loss and use automatic differentiation with modern optimizers. Loss combines FC error and activity deviation from FIC target.
</field>
        </record>

        <record id="experiment_ei_tuning_fic_eib_optimization" model="tvbo.simulation_experiment">
            <field name="label">EI Tuning: Functional Connectivity Fitting</field>
            <field name="description">Fitting functional connectivity using the two-population Reduced Wong-Wang model with explicit excitatory and inhibitory populations. Combines Feedback Inhibition Control (FIC) to maintain local E-I balance with EIB tuning to globally optimize network connectivity. Supports both iterative (FIC+EIB) and gradient-based optimization approaches.
</field>
            <field name="dynamics" eval="[(6, 0, [ref('exp_ei_tuning_fic_eib_optimization_dynamics')])]"/>
            <field name="network" ref="exp_ei_tuning_fic_eib_optimization_network"/>
            <field name="integration" ref="exp_ei_tuning_fic_eib_optimization_integrator"/>
            <field name="functions" eval="[(6, 0, [ref('exp_ei_tuning_fic_eib_optimization_func_hrf_kernel'), ref('exp_ei_tuning_fic_eib_optimization_func_prepend_history'), ref('exp_ei_tuning_fic_eib_optimization_func_volterra_transform'), ref('exp_ei_tuning_fic_eib_optimization_func_subsample_bold'), ref('exp_ei_tuning_fic_eib_optimization_func_rmse'), ref('exp_ei_tuning_fic_eib_optimization_func_correlation'), ref('exp_ei_tuning_fic_eib_optimization_func_fc_corr'), ref('exp_ei_tuning_fic_eib_optimization_func_fc_rmse'), ref('exp_ei_tuning_fic_eib_optimization_func_compute_fc'), ref('exp_ei_tuning_fic_eib_optimization_func_mean_activity'), ref('exp_ei_tuning_fic_eib_optimization_func_fic_update_rule'), ref('exp_ei_tuning_fic_eib_optimization_func_eib_update_wlre'), ref('exp_ei_tuning_fic_eib_optimization_func_eib_update_wffi'), ref('exp_ei_tuning_fic_eib_optimization_func_combined_loss')])]"/>
            <field name="observations" eval="[(6, 0, [ref('exp_ei_tuning_fic_eib_optimization_obs_bold'), ref('exp_ei_tuning_fic_eib_optimization_obs_mean_s_e'), ref('exp_ei_tuning_fic_eib_optimization_obs_mean_s_e_final'), ref('exp_ei_tuning_fic_eib_optimization_obs_mean_s_i'), ref('exp_ei_tuning_fic_eib_optimization_obs_fc_target')])]"/>
            <field name="derived_observations" eval="[(6, 0, [ref('exp_ei_tuning_fic_eib_optimization_dobs_fc'), ref('exp_ei_tuning_fic_eib_optimization_dobs_fc_inloop'), ref('exp_ei_tuning_fic_eib_optimization_dobs_fc_gradient'), ref('exp_ei_tuning_fic_eib_optimization_dobs_fc_corr'), ref('exp_ei_tuning_fic_eib_optimization_dobs_fc_rmse')])]"/>
            <field name="algorithms" eval="[(6, 0, [ref('exp_ei_tuning_fic_eib_optimization_algo_fic'), ref('exp_ei_tuning_fic_eib_optimization_algo_fic_eib')])]"/>
            <field name="optimization" eval="[(6, 0, [ref('exp_ei_tuning_fic_eib_optimization_opt_gradient_eib')])]"/>
            <field name="execution" ref="exp_ei_tuning_fic_eib_optimization_execution"/>
            <field name="references">- Schirner, M., Deco, G., &amp; Ritter, P. (2023). Learning how network structure shapes decision-making for bio-inspired computing. Nature Communications, 14(1), Article 1.
- Wong, K.-F., &amp; Wang, X.-J. (2006). A recurrent network mechanism of time integration in perceptual decisions. J Neurosci, 26:1314-1328.
- Deco, G., Ponce-Alvarez, A., Mantini, D., Romani, G.L., Hagmann, P., &amp; Corbetta, M. (2013). Resting-state functional connectivity emerges from structurally and dynamically shaped slow linear fluctuations. J Neurosci, 33(27):11239-11252.</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_param_a" model="tvbo.parameter">
            <field name="name">A</field>
            <field name="value">3.25</field>
            <field name="unit">mV</field>
            <field name="description">Maximum amplitude of EPSP [mV]</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_param_b" model="tvbo.parameter">
            <field name="name">B</field>
            <field name="value">22.0</field>
            <field name="unit">mV</field>
            <field name="description">Maximum amplitude of IPSP [mV]</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_param_a_range" model="tvbo.range">
            <field name="lo">0.001</field>
            <field name="hi">0.2</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_param_a" model="tvbo.parameter">
            <field name="name">a</field>
            <field name="value">0.065</field>
            <field name="unit">ms^-1</field>
            <field name="description">Reciprocal of membrane time constant (excitatory)</field>
            <field name="domain" ref="exp_jr_meg_frequencygradient_optimization_dyn_param_a_range"/>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_param_b_range" model="tvbo.range">
            <field name="lo">0.001</field>
            <field name="hi">0.2</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_param_b" model="tvbo.parameter">
            <field name="name">b</field>
            <field name="value">0.065</field>
            <field name="unit">ms^-1</field>
            <field name="description">Reciprocal of membrane time constant (inhibitory)</field>
            <field name="domain" ref="exp_jr_meg_frequencygradient_optimization_dyn_param_b_range"/>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_param_v0" model="tvbo.parameter">
            <field name="name">v0</field>
            <field name="value">5.52</field>
            <field name="unit">mV</field>
            <field name="description">Firing threshold [mV]</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_param_nu_max" model="tvbo.parameter">
            <field name="name">nu_max</field>
            <field name="value">0.0025</field>
            <field name="unit">ms^-1</field>
            <field name="description">Maximum firing rate</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_param_r" model="tvbo.parameter">
            <field name="name">r</field>
            <field name="value">0.56</field>
            <field name="unit">mV^-1</field>
            <field name="description">Steepness of sigmoid</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_param_j" model="tvbo.parameter">
            <field name="name">J</field>
            <field name="value">135.0</field>
            <field name="description">Average number of synapses</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_param_a_1" model="tvbo.parameter">
            <field name="name">a_1</field>
            <field name="value">1.0</field>
            <field name="description">Excitatory feedback probability</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_param_a_2" model="tvbo.parameter">
            <field name="name">a_2</field>
            <field name="value">0.8</field>
            <field name="description">Slow excitatory feedback probability</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_param_a_3" model="tvbo.parameter">
            <field name="name">a_3</field>
            <field name="value">0.25</field>
            <field name="description">Inhibitory feedback probability</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_param_a_4" model="tvbo.parameter">
            <field name="name">a_4</field>
            <field name="value">0.25</field>
            <field name="description">Slow inhibitory feedback probability</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_param_mu" model="tvbo.parameter">
            <field name="name">mu</field>
            <field name="value">0.15</field>
            <field name="description">Mean input firing rate</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_sv_y0_eq" model="tvbo.equation">
            <field name="label">dy0/dt</field>
            <field name="lefthandside">dy0/dt</field>
            <field name="righthandside">y3</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_sv_y0" model="tvbo.state_variable">
            <field name="name">y0</field>
            <field name="initial_value">0.0</field>
            <field name="equation" ref="exp_jr_meg_frequencygradient_optimization_dyn_sv_y0_eq"/>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_sv_y1_eq" model="tvbo.equation">
            <field name="label">dy1/dt</field>
            <field name="lefthandside">dy1/dt</field>
            <field name="righthandside">y4</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_sv_y1" model="tvbo.state_variable">
            <field name="name">y1</field>
            <field name="initial_value">5.0</field>
            <field name="equation" ref="exp_jr_meg_frequencygradient_optimization_dyn_sv_y1_eq"/>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_sv_y2_eq" model="tvbo.equation">
            <field name="label">dy2/dt</field>
            <field name="lefthandside">dy2/dt</field>
            <field name="righthandside">y5</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_sv_y2" model="tvbo.state_variable">
            <field name="name">y2</field>
            <field name="initial_value">5.0</field>
            <field name="equation" ref="exp_jr_meg_frequencygradient_optimization_dyn_sv_y2_eq"/>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_sv_y3_eq" model="tvbo.equation">
            <field name="label">dy3/dt</field>
            <field name="lefthandside">dy3/dt</field>
            <field name="righthandside">A * a * sigm_y1_y2 - 2.0 * a * y3 - a**2 * y0</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_sv_y3" model="tvbo.state_variable">
            <field name="name">y3</field>
            <field name="initial_value">0.0</field>
            <field name="equation" ref="exp_jr_meg_frequencygradient_optimization_dyn_sv_y3_eq"/>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_sv_y4_eq" model="tvbo.equation">
            <field name="label">dy4/dt</field>
            <field name="lefthandside">dy4/dt</field>
            <field name="righthandside">A * a * (mu + a_2 * J * sigm_y0_1 + DelayedSigmoidalJansenRit) - 2.0 * a * y4 - a**2 * y1</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_sv_y4" model="tvbo.state_variable">
            <field name="name">y4</field>
            <field name="initial_value">0.0</field>
            <field name="coupling_variable">True</field>
            <field name="equation" ref="exp_jr_meg_frequencygradient_optimization_dyn_sv_y4_eq"/>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_sv_y5_eq" model="tvbo.equation">
            <field name="label">dy5/dt</field>
            <field name="lefthandside">dy5/dt</field>
            <field name="righthandside">B * b * (a_4 * J * sigm_y0_3) - 2.0 * b * y5 - b**2 * y2</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_sv_y5" model="tvbo.state_variable">
            <field name="name">y5</field>
            <field name="initial_value">0.0</field>
            <field name="equation" ref="exp_jr_meg_frequencygradient_optimization_dyn_sv_y5_eq"/>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_dv_sigm_y1_y2_eq" model="tvbo.equation">
            <field name="label">sigm_y1_y2</field>
            <field name="lefthandside">sigm_y1_y2</field>
            <field name="righthandside">2.0 * nu_max / (1.0 + exp(r * (v0 - (y1 - y2))))</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_dv_sigm_y1_y2" model="tvbo.derived_variable">
            <field name="name">sigm_y1_y2</field>
            <field name="description">Sigmoid of y1-y2</field>
            <field name="equation" ref="exp_jr_meg_frequencygradient_optimization_dyn_dv_sigm_y1_y2_eq"/>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_dv_sigm_y0_1_eq" model="tvbo.equation">
            <field name="label">sigm_y0_1</field>
            <field name="lefthandside">sigm_y0_1</field>
            <field name="righthandside">2.0 * nu_max / (1.0 + exp(r * (v0 - (a_1 * J * y0))))</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_dv_sigm_y0_1" model="tvbo.derived_variable">
            <field name="name">sigm_y0_1</field>
            <field name="description">Sigmoid of a_1*J*y0</field>
            <field name="equation" ref="exp_jr_meg_frequencygradient_optimization_dyn_dv_sigm_y0_1_eq"/>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_dv_sigm_y0_3_eq" model="tvbo.equation">
            <field name="label">sigm_y0_3</field>
            <field name="lefthandside">sigm_y0_3</field>
            <field name="righthandside">2.0 * nu_max / (1.0 + exp(r * (v0 - (a_3 * J * y0))))</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dyn_dv_sigm_y0_3" model="tvbo.derived_variable">
            <field name="name">sigm_y0_3</field>
            <field name="description">Sigmoid of a_3*J*y0</field>
            <field name="equation" ref="exp_jr_meg_frequencygradient_optimization_dyn_dv_sigm_y0_3_eq"/>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dynamics" model="tvbo.dynamics">
            <field name="name">JansenRit</field>
            <field name="label">Jansen-Rit Neural Mass Model</field>
            <field name="description">Neural mass model with three populations (pyramidal, excitatory interneurons, inhibitory interneurons). Produces characteristic alpha-band oscillations.
</field>
            <field name="parameters" eval="[(6, 0, [ref('exp_jr_meg_frequencygradient_optimization_dyn_param_a'), ref('exp_jr_meg_frequencygradient_optimization_dyn_param_b'), ref('exp_jr_meg_frequencygradient_optimization_dyn_param_a'), ref('exp_jr_meg_frequencygradient_optimization_dyn_param_b'), ref('exp_jr_meg_frequencygradient_optimization_dyn_param_v0'), ref('exp_jr_meg_frequencygradient_optimization_dyn_param_nu_max'), ref('exp_jr_meg_frequencygradient_optimization_dyn_param_r'), ref('exp_jr_meg_frequencygradient_optimization_dyn_param_j'), ref('exp_jr_meg_frequencygradient_optimization_dyn_param_a_1'), ref('exp_jr_meg_frequencygradient_optimization_dyn_param_a_2'), ref('exp_jr_meg_frequencygradient_optimization_dyn_param_a_3'), ref('exp_jr_meg_frequencygradient_optimization_dyn_param_a_4'), ref('exp_jr_meg_frequencygradient_optimization_dyn_param_mu')])]"/>
            <field name="state_variables" eval="[(6, 0, [ref('exp_jr_meg_frequencygradient_optimization_dyn_sv_y0'), ref('exp_jr_meg_frequencygradient_optimization_dyn_sv_y1'), ref('exp_jr_meg_frequencygradient_optimization_dyn_sv_y2'), ref('exp_jr_meg_frequencygradient_optimization_dyn_sv_y3'), ref('exp_jr_meg_frequencygradient_optimization_dyn_sv_y4'), ref('exp_jr_meg_frequencygradient_optimization_dyn_sv_y5')])]"/>
            <field name="derived_variables" eval="[(6, 0, [ref('exp_jr_meg_frequencygradient_optimization_dyn_dv_sigm_y1_y2'), ref('exp_jr_meg_frequencygradient_optimization_dyn_dv_sigm_y0_1'), ref('exp_jr_meg_frequencygradient_optimization_dyn_dv_sigm_y0_3')])]"/>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_cp_delayedsigmoidaljansenrit_g" model="tvbo.parameter">
            <field name="name">G</field>
            <field name="value">15.0</field>
            <field name="description">Global coupling strength</field>
            <field name="free">True</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_cp_delayedsigmoidaljansenrit_cmin" model="tvbo.parameter">
            <field name="name">cmin</field>
            <field name="value">0.0</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_cp_delayedsigmoidaljansenrit_cmax" model="tvbo.parameter">
            <field name="name">cmax</field>
            <field name="value">0.005</field>
            <field name="description">2 * nu_max from TVB default</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_cp_delayedsigmoidaljansenrit_midpoint" model="tvbo.parameter">
            <field name="name">midpoint</field>
            <field name="value">6.0</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_cp_delayedsigmoidaljansenrit_r" model="tvbo.parameter">
            <field name="name">r</field>
            <field name="value">0.56</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_coupling_delayedsigmoidaljansenrit_pre_expr" model="tvbo.equation">
            <field name="righthandside">cmin + (cmax - cmin) / (1.0 + exp(r * (midpoint - (y1 - y2))))</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_coupling_delayedsigmoidaljansenrit_post_expr" model="tvbo.equation">
            <field name="righthandside">G * gx</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_coupling_delayedsigmoidaljansenrit" model="tvbo.coupling">
            <field name="name">DelayedSigmoidalJansenRit</field>
            <field name="label">Delayed Sigmoidal Jansen-Rit Coupling</field>
            <field name="description">Sigmoidal Jansen-Rit coupling function with delays</field>
            <field name="delayed">True"</field>
            <field name="pre_expression" ref="exp_jr_meg_frequencygradient_optimization_coupling_delayedsigmoidaljansenrit_pre_expr"/>
            <field name="post_expression" ref="exp_jr_meg_frequencygradient_optimization_coupling_delayedsigmoidaljansenrit_post_expr"/>
            <field name="parameters" eval="[(6, 0, [ref('exp_jr_meg_frequencygradient_optimization_cp_delayedsigmoidaljansenrit_g'), ref('exp_jr_meg_frequencygradient_optimization_cp_delayedsigmoidaljansenrit_cmin'), ref('exp_jr_meg_frequencygradient_optimization_cp_delayedsigmoidaljansenrit_cmax'), ref('exp_jr_meg_frequencygradient_optimization_cp_delayedsigmoidaljansenrit_midpoint'), ref('exp_jr_meg_frequencygradient_optimization_cp_delayedsigmoidaljansenrit_r')])]"/>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_network" model="tvbo.network">
            <field name="label">Desikan-Killiany</field>
            <field name="description">Structural connectivity from dk_average dataset</field>
            <field name="bids_dir">../networks/bids/dk_average</field>
            <field name="coupling" eval="[(6, 0, [ref('exp_jr_meg_frequencygradient_optimization_coupling_delayedsigmoidaljansenrit')])]"/>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_integrator" model="tvbo.integrator">
            <field name="method">Heun</field>
            <field name="step_size">1.0</field>
            <field name="duration">1000</field>
            <field name="transient_time">20000</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_execution" model="tvbo.execution_config">
            <field name="n_workers">8</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_func_subsample" model="tvbo.function">
            <field name="name">subsample</field>
            <field name="description">Downsample array by step factor</field>
            <field name="source_code">data[::step]</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_func_index_at" model="tvbo.function">
            <field name="name">index_at</field>
            <field name="description">Index into array at given position</field>
            <field name="source_code">arr[idx]</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_func_compute_target_frequencies" model="tvbo.function">
            <field name="name">compute_target_frequencies</field>
            <field name="description">Compute target frequencies from tract lengths to visual cortex</field>
            <field name="definition">f_max - (f_max - f_min) * (d - min(d)) / (max(d) - min(d))</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_func_cauchy_pdf" model="tvbo.function">
            <field name="name">cauchy_pdf</field>
            <field name="description">Cauchy-Lorentz probability density function</field>
            <field name="definition">1 / (pi * gamma * (1 + ((x - x0) / gamma)**2))</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_func_correlation" model="tvbo.function">
            <field name="name">correlation</field>
            <field name="description">Pearson correlation coefficient</field>
            <field name="definition">Sum((x[i] - mean(x)) * (y[i] - mean(y)), (i, 0, n-1)) / sqrt(Sum((x[i] - mean(x))**2, (i, 0, n-1)) * Sum((y[i] - mean(y))**2, (i, 0, n-1)))</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_func_spectral_loss" model="tvbo.function">
            <field name="name">spectral_loss</field>
            <field name="description">1 - correlation between simulated and target spectra (per-element)</field>
            <field name="definition">1 - correlation(simulated, target)</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_obs_simulated_psd" model="tvbo.observation">
            <field name="name">simulated_psd</field>
            <field name="label">Simulated Power Spectral Density</field>
            <field name="description">Power spectral density using Welch&apos;s method on simulated y0</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dobs_avg_spectrum" model="tvbo.derived_observation">
            <field name="name">avg_spectrum</field>
            <field name="label">Average Spectrum</field>
            <field name="description">Mean power spectrum across all regions</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dobs_peak_frequencies" model="tvbo.derived_observation">
            <field name="name">peak_frequencies</field>
            <field name="label">Peak Frequencies per Region</field>
            <field name="description">Peak frequency for each brain region from its PSD</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_dobs_peak_frequency" model="tvbo.derived_observation">
            <field name="name">peak_frequency</field>
            <field name="label">Peak Frequency</field>
            <field name="description">Extract peak frequency from average spectrum</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_opt_spectral_gradient_fit" model="tvbo.optimization">
            <field name="name">spectral_gradient_fit</field>
            <field name="label">Spectral Gradient Fitting</field>
            <field name="description">Fit region-specific a and b parameters to reproduce the MEG frequency gradient. Target frequencies range from 11 Hz (visual cortex) to 7 Hz (most distant regions from lateral occipital gyrus).
</field>
        </record>

        <record id="exp_jr_meg_frequencygradient_optimization_explr_frequency_landscape" model="tvbo.exploration">
            <field name="name">frequency_landscape</field>
            <field name="label">Frequency Landscape Exploration</field>
            <field name="description">Grid search over a and b parameters to map the relationship between time constants and peak oscillation frequency. Used to understand the parameter landscape before optimization.
</field>
            <field name="mode">product</field>
        </record>

        <record id="experiment_jr_meg_frequencygradient_optimization" model="tvbo.simulation_experiment">
            <field name="label">JR Peak Frequency Optimization</field>
            <field name="description">Reproducing MEG Resting-State Frequency Gradients with Network Dynamics. This experiment fits region-specific Jansen-Rit parameters to reproduce the empirical frequency gradient from visual cortex (11 Hz) to association areas (7 Hz).
</field>
            <field name="dynamics" eval="[(6, 0, [ref('exp_jr_meg_frequencygradient_optimization_dynamics')])]"/>
            <field name="network" ref="exp_jr_meg_frequencygradient_optimization_network"/>
            <field name="integration" ref="exp_jr_meg_frequencygradient_optimization_integrator"/>
            <field name="functions" eval="[(6, 0, [ref('exp_jr_meg_frequencygradient_optimization_func_subsample'), ref('exp_jr_meg_frequencygradient_optimization_func_index_at'), ref('exp_jr_meg_frequencygradient_optimization_func_compute_target_frequencies'), ref('exp_jr_meg_frequencygradient_optimization_func_cauchy_pdf'), ref('exp_jr_meg_frequencygradient_optimization_func_correlation'), ref('exp_jr_meg_frequencygradient_optimization_func_spectral_loss')])]"/>
            <field name="observations" eval="[(6, 0, [ref('exp_jr_meg_frequencygradient_optimization_obs_simulated_psd')])]"/>
            <field name="derived_observations" eval="[(6, 0, [ref('exp_jr_meg_frequencygradient_optimization_dobs_avg_spectrum'), ref('exp_jr_meg_frequencygradient_optimization_dobs_peak_frequencies'), ref('exp_jr_meg_frequencygradient_optimization_dobs_peak_frequency')])]"/>
            <field name="optimization" eval="[(6, 0, [ref('exp_jr_meg_frequencygradient_optimization_opt_spectral_gradient_fit')])]"/>
            <field name="explorations" eval="[(6, 0, [ref('exp_jr_meg_frequencygradient_optimization_explr_frequency_landscape')])]"/>
            <field name="execution" ref="exp_jr_meg_frequencygradient_optimization_execution"/>
            <field name="references">- Mahjoory et al. (2020) eLife 9:e53715 - MEG frequency gradient
- Jansen &amp; Rit (1995) Biol Cybern 73:357-366 - Neural mass model</field>
        </record>

        <record id="exp_rww_bold_fc_optimization_dyn_param_a" model="tvbo.parameter">
            <field name="name">a</field>
            <field name="label">Input gain parameter</field>
            <field name="value">0.27</field>
            <field name="unit">n/C</field>
        </record>

        <record id="exp_rww_bold_fc_optimization_dyn_param_b" model="tvbo.parameter">
            <field name="name">b</field>
            <field name="label">Input shift parameter</field>
            <field name="value">0.108</field>
            <field name="unit">kHz</field>
        </record>

        <record id="exp_rww_bold_fc_optimization_dyn_param_d" model="tvbo.parameter">
            <field name="name">d</field>
            <field name="label">Parameter for H function</field>
            <field name="value">154.0</field>
            <field name="unit">ms</field>
        </record>

        <record id="exp_rww_bold_fc_optimization_dyn_param_gamma" model="tvbo.parameter">
            <field name="name">gamma</field>
            <field name="label">Kinetic parameter</field>
            <field name="value">0.641</field>
        </record>

        <record id="exp_rww_bold_fc_optimization_dyn_param_tau_s" model="tvbo.parameter">
            <field name="name">tau_s</field>
            <field name="label">Synaptic time constant</field>
            <field name="value">100.0</field>
            <field name="unit">ms</field>
        </record>

        <record id="exp_rww_bold_fc_optimization_dyn_param_w_range" model="tvbo.range">
            <field name="lo">0.0</field>
            <field name="hi">1.0</field>
        </record>

        <record id="exp_rww_bold_fc_optimization_dyn_param_w" model="tvbo.parameter">
            <field name="name">w</field>
            <field name="label">Excitatory recurrence</field>
            <field name="value">0.5</field>
            <field name="domain" ref="exp_rww_bold_fc_optimization_dyn_param_w_range"/>
        </record>

        <record id="exp_rww_bold_fc_optimization_dyn_param_j_n" model="tvbo.parameter">
            <field name="name">J_N</field>
            <field name="label">Excitatory recurrence</field>
            <field name="value">0.2609</field>
        </record>

        <record id="exp_rww_bold_fc_optimization_dyn_param_i_o" model="tvbo.parameter">
            <field name="name">I_o</field>
            <field name="label">External input</field>
            <field name="value">0.32</field>
        </record>

        <record id="exp_rww_bold_fc_optimization_dyn_sv_s_eq" model="tvbo.equation">
            <field name="label">dS/dt</field>
            <field name="lefthandside">dS/dt</field>
            <field name="righthandside">-(S / tau_s) + (1 - S) * H * gamma</field>
        </record>

        <record id="exp_rww_bold_fc_optimization_dyn_sv_s" model="tvbo.state_variable">
            <field name="name">S</field>
            <field name="label">Synaptic gating</field>
            <field name="initial_value">0.3</field>
            <field name="coupling_variable">True</field>
            <field name="description">Fraction of open NMDA channels</field>
            <field name="equation" ref="exp_rww_bold_fc_optimization_dyn_sv_s_eq"/>
        </record>

        <record id="exp_rww_bold_fc_optimization_dyn_dv_x_eq" model="tvbo.equation">
            <field name="label">x</field>
            <field name="lefthandside">x</field>
            <field name="righthandside">w * J_N * S + I_o + J_N * FastLinearCoupling</field>
        </record>

        <record id="exp_rww_bold_fc_optimization_dyn_dv_x" model="tvbo.derived_variable">
            <field name="name">x</field>
            <field name="label">Total synaptic input</field>
            <field name="description">Sum of local recurrence, external input, and long-range coupling</field>
            <field name="equation" ref="exp_rww_bold_fc_optimization_dyn_dv_x_eq"/>
        </record>

        <record id="exp_rww_bold_fc_optimization_dyn_dv_h_eq" model="tvbo.equation">
            <field name="label">H</field>
            <field name="lefthandside">H</field>
            <field name="righthandside">(a * x - b) / (1 - exp(-d * (a * x - b)))</field>
        </record>

        <record id="exp_rww_bold_fc_optimization_dyn_dv_h" model="tvbo.derived_variable">
            <field name="name">H</field>
            <field name="label">Population firing rate</field>
            <field name="description">Sigmoidal transfer function converting input to firing rate</field>
            <field name="equation" ref="exp_rww_bold_fc_optimization_dyn_dv_h_eq"/>
        </record>

        <record id="exp_rww_bold_fc_optimization_dynamics" model="tvbo.dynamics">
            <field name="name">ReducedWongWang</field>
            <field name="label">Reduced Wong-Wang Model</field>
            <field name="description">Biophysically-based neural mass model for BOLD FC fitting. Captures slow dynamics relevant for resting-state fMRI.
</field>
            <field name="parameters" eval="[(6, 0, [ref('exp_rww_bold_fc_optimization_dyn_param_a'), ref('exp_rww_bold_fc_optimization_dyn_param_b'), ref('exp_rww_bold_fc_optimization_dyn_param_d'), ref('exp_rww_bold_fc_optimization_dyn_param_gamma'), ref('exp_rww_bold_fc_optimization_dyn_param_tau_s'), ref('exp_rww_bold_fc_optimization_dyn_param_w'), ref('exp_rww_bold_fc_optimization_dyn_param_j_n'), ref('exp_rww_bold_fc_optimization_dyn_param_i_o')])]"/>
            <field name="state_variables" eval="[(6, 0, [ref('exp_rww_bold_fc_optimization_dyn_sv_s')])]"/>
            <field name="derived_variables" eval="[(6, 0, [ref('exp_rww_bold_fc_optimization_dyn_dv_x'), ref('exp_rww_bold_fc_optimization_dyn_dv_h')])]"/>
        </record>

        <record id="exp_rww_bold_fc_optimization_cp_fastlinearcoupling_g_range" model="tvbo.range">
            <field name="lo">0.0</field>
            <field name="hi">1.0</field>
        </record>

        <record id="exp_rww_bold_fc_optimization_cp_fastlinearcoupling_g" model="tvbo.parameter">
            <field name="name">G</field>
            <field name="label">Global coupling</field>
            <field name="value">0.5</field>
            <field name="description">Global scaling of long-range connections</field>
            <field name="free">True</field>
            <field name="domain" ref="exp_rww_bold_fc_optimization_cp_fastlinearcoupling_g_range"/>
        </record>

        <record id="exp_rww_bold_fc_optimization_coupling_fastlinearcoupling_pre_expr" model="tvbo.equation">
            <field name="righthandside">local_states</field>
        </record>

        <record id="exp_rww_bold_fc_optimization_coupling_fastlinearcoupling_post_expr" model="tvbo.equation">
            <field name="righthandside">G * gx</field>
        </record>

        <record id="exp_rww_bold_fc_optimization_coupling_fastlinearcoupling" model="tvbo.coupling">
            <field name="name">FastLinearCoupling</field>
            <field name="label">Fast Linear Coupling</field>
            <field name="description">Instantaneous linear coupling (no conduction delays)</field>
            <field name="delayed">False"</field>
            <field name="pre_expression" ref="exp_rww_bold_fc_optimization_coupling_fastlinearcoupling_pre_expr"/>
            <field name="post_expression" ref="exp_rww_bold_fc_optimization_coupling_fastlinearcoupling_post_expr"/>
            <field name="parameters" eval="[(6, 0, [ref('exp_rww_bold_fc_optimization_cp_fastlinearcoupling_g')])]"/>
        </record>

        <record id="exp_rww_bold_fc_optimization_network" model="tvbo.network">
            <field name="label">Desikan-Killiany</field>
            <field name="description">Structural connectivity from dk_average dataset</field>
            <field name="bids_dir">../networks/bids/dk_average</field>
            <field name="coupling" eval="[(6, 0, [ref('exp_rww_bold_fc_optimization_coupling_fastlinearcoupling')])]"/>
        </record>

        <record id="exp_rww_bold_fc_optimization_integrator" model="tvbo.integrator">
            <field name="method">Heun</field>
            <field name="step_size">4.0</field>
            <field name="duration">120000</field>
            <field name="transient_time">120000</field>
        </record>

        <record id="exp_rww_bold_fc_optimization_execution" model="tvbo.execution_config">
            <field name="n_workers">8</field>
            <field name="precision">float64</field>
            <field name="random_seed">0</field>
        </record>

        <record id="exp_rww_bold_fc_optimization_func_temporal_average" model="tvbo.function">
            <field name="name">temporal_average</field>
            <field name="description">Temporal average downsampling</field>
            <field name="source_code">jnp.mean(data.reshape(-1, period_samples, *data.shape[1:]), axis=1)</field>
        </record>

        <record id="exp_rww_bold_fc_optimization_func_hrf_kernel" model="tvbo.function">
            <field name="name">hrf_kernel</field>
            <field name="description">Hemodynamic response function kernel (Lotka-Volterra)</field>
            <field name="definition">(1/3)*exp(-0.5*(t/1000)/tau_s)*sin(sqrt(1/tau_f - 1/(4*tau_s**2))*(t/1000))/sqrt(1/tau_f - 1/(4*tau_s**2))</field>
        </record>

        <record id="exp_rww_bold_fc_optimization_func_prepend_history" model="tvbo.function">
            <field name="name">prepend_history</field>
            <field name="description">Prepend transient history to data for convolution</field>
            <field name="source_code">jnp.concatenate([history[-kernel_samples:], data], axis=0)</field>
        </record>

        <record id="exp_rww_bold_fc_optimization_func_volterra_transform" model="tvbo.function">
            <field name="name">volterra_transform</field>
            <field name="description">Volterra nonlinear BOLD transformation</field>
            <field name="definition">k_1 * V_0 * (data - 1.0)</field>
        </record>

        <record id="exp_rww_bold_fc_optimization_func_subsample_bold" model="tvbo.function">
            <field name="name">subsample_bold</field>
            <field name="description">Subsample to BOLD TR (final_period / downsample_period)</field>
            <field name="source_code">data[::step][:n_samples]</field>
        </record>

        <record id="exp_rww_bold_fc_optimization_func_rmse" model="tvbo.function">
            <field name="name">rmse</field>
            <field name="description">Root mean squared error</field>
            <field name="definition">sqrt(mean((x - y)**2))</field>
        </record>

        <record id="exp_rww_bold_fc_optimization_func_fc_corr" model="tvbo.function">
            <field name="name">fc_corr</field>
            <field name="description">FC correlation (upper triangle)</field>
        </record>

        <record id="exp_rww_bold_fc_optimization_obs_empirical_fc" model="tvbo.observation">
            <field name="name">empirical_fc</field>
            <field name="label">Empirical Functional Connectivity</field>
            <field name="description">Target FC matrix from network observations (loaded from BIDS)</field>
        </record>

        <record id="exp_rww_bold_fc_optimization_obs_bold" model="tvbo.observation">
            <field name="name">bold</field>
            <field name="label">Simulated BOLD Signal</field>
            <field name="description">BOLD signal from hemodynamic response function (matches tvboptim Bold)</field>
        </record>

        <record id="exp_rww_bold_fc_optimization_dobs_fc" model="tvbo.derived_observation">
            <field name="name">fc</field>
            <field name="label">Simulated Functional Connectivity</field>
            <field name="description">Pearson correlation matrix from BOLD time series</field>
        </record>

        <record id="exp_rww_bold_fc_optimization_opt_fc_fitting" model="tvbo.optimization">
            <field name="name">fc_fitting</field>
            <field name="label">FC Fitting</field>
            <field name="description">Two-stage optimization to fit empirical FC. Stage 1: Global parameters (w, G) - same for all regions. Stage 2: Regional parameters (w, I_o) - heterogeneous across regions.
</field>
        </record>

        <record id="exp_rww_bold_fc_optimization_explr_parameter_landscape" model="tvbo.exploration">
            <field name="name">parameter_landscape</field>
            <field name="label">w-G Parameter Landscape</field>
            <field name="description">Grid search over excitatory recurrence (w) and global coupling (G) to understand the FC fitting landscape before optimization.
</field>
            <field name="mode">product</field>
        </record>

        <record id="experiment_rww_bold_fc_optimization" model="tvbo.simulation_experiment">
            <field name="label">RWW Functional Connectivity Fitting</field>
            <field name="description">Fitting functional connectivity using the Reduced Wong-Wang model. Two-stage optimization: global parameters first, then regional heterogeneity. Based on tvboptim RWW.qmd tutorial.
</field>
            <field name="dynamics" eval="[(6, 0, [ref('exp_rww_bold_fc_optimization_dynamics')])]"/>
            <field name="network" ref="exp_rww_bold_fc_optimization_network"/>
            <field name="integration" ref="exp_rww_bold_fc_optimization_integrator"/>
            <field name="functions" eval="[(6, 0, [ref('exp_rww_bold_fc_optimization_func_temporal_average'), ref('exp_rww_bold_fc_optimization_func_hrf_kernel'), ref('exp_rww_bold_fc_optimization_func_prepend_history'), ref('exp_rww_bold_fc_optimization_func_volterra_transform'), ref('exp_rww_bold_fc_optimization_func_subsample_bold'), ref('exp_rww_bold_fc_optimization_func_rmse'), ref('exp_rww_bold_fc_optimization_func_fc_corr')])]"/>
            <field name="observations" eval="[(6, 0, [ref('exp_rww_bold_fc_optimization_obs_empirical_fc'), ref('exp_rww_bold_fc_optimization_obs_bold')])]"/>
            <field name="derived_observations" eval="[(6, 0, [ref('exp_rww_bold_fc_optimization_dobs_fc')])]"/>
            <field name="optimization" eval="[(6, 0, [ref('exp_rww_bold_fc_optimization_opt_fc_fitting')])]"/>
            <field name="explorations" eval="[(6, 0, [ref('exp_rww_bold_fc_optimization_explr_parameter_landscape')])]"/>
            <field name="execution" ref="exp_rww_bold_fc_optimization_execution"/>
            <field name="references">- Wong &amp; Wang (2006) J Neurosci 26:1314-1328 - Reduced Wong-Wang model
- Deco et al. (2014) J Neurosci 34:7886-7898 - Resting-state FC modeling</field>
        </record>

        <record id="exp_rateml_reducedwongwang_network" model="tvbo.network">
        </record>

        <record id="exp_rateml_reducedwongwang_integrator" model="tvbo.integrator">
            <field name="method">euler</field>
            <field name="step_size">0.1</field>
            <field name="duration">1000.0</field>
        </record>

        <record id="exp_rateml_reducedwongwang_obs_bold" model="tvbo.observation">
            <field name="name">bold</field>
            <field name="description">BOLD fMRI observation using BalloonWindkessel dynamics</field>
        </record>

        <record id="experiment_rateml_reducedwongwang" model="tvbo.simulation_experiment">
            <field name="label">RateML rwongwang ground truth</field>
            <field name="network" ref="exp_rateml_reducedwongwang_network"/>
            <field name="integration" ref="exp_rateml_reducedwongwang_integrator"/>
            <field name="observations" eval="[(6, 0, [ref('exp_rateml_reducedwongwang_obs_bold')])]"/>
        </record>

    </data>
</odoo>