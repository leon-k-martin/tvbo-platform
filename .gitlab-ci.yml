deploy-job:
  stage: deploy
  tags:
    - odoomoduleupdate
  script:
    - export KUBECONFIG=/home/gitlab-runner/kubeconfig.yaml
    - kubectl delete job coordinatef-module-loader --ignore-not-found
    - kubectl apply -f tvboRunnerActions.yaml
    - |
        echo "Waiting for tvbo-odoo pod to be Running..."
        until POD="$(kubectl get pods \
          -l app=tvbo-odoo \
          --field-selector=status.phase=Running \
          -o jsonpath='{.items[0].metadata.name}' 2>/dev/null)" \
          && [ -n "$POD" ]; do
          sleep 1
        done

        echo "Pod: $POD"
        kubectl logs -f "$POD"
  when: manual

